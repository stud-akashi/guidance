<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
    <title>Guidance</title>
<script>
  (function(d) {
    var config = {
      kitId: 'npc5aqa',
      scriptTimeout: 3000,
      async: true
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>
<style type="text/css">
<!--
@page{
  size: A4 portrait;
  margin: 0;
}
@media screen{
  div.page{
    display: none;
  }
  ul{
    list-style-type: none;
  }
  body{
    font-size: 18px;
  }
  input, button{
    font-size: 18px;
    margin: 3px;
  }
}
      
 @media print{
  body {
    -webkit-print-color-adjust: exact;
    top:0 !IMPORTANT;
    left:0 !IMPORTANT;
    width:200mm !IMPORTANT;
    height:290mm !IMPORTANT;
  }

div.control{
  display: none;
}

div.page{
  position: absolute;
  top: 50%;
  left: 50%;
  width: 182mm;
  height: 275mm;
  margin: -137.5mm 0 0 -91mm;
  border: 1px solid;
  border-color: white;
  border-collapse: collapse;

  font-family: source-han-sans-japanese, sans-serif;
  font-weight: 100;
  font-style: normal;
  font-size: 27pt;
}

.page-title{
  position: absolute;
  right: 9mm;
  top: 18mm;
  letter-spacing: 0.3em;
}

.stud{
  position: absolute;
  bottom: 8mm;
  right: 9mm;
  text-align: center;
  
  font-family: futura-pt, sans-serif;
  font-weight: 300;
  font-style: normal;
  font-size: 10pt;
}
.logo{
  width: 8.5mm;
  height: 8.5mm;
}
.allign-bottom{
  position: absolute;
  bottom: 2mm;
}

.text-small{
  font-size: 16pt;
}

.line-left{
  position: absolute;
  border-left: 1px black solid;
  position: absolute;
  top: 8mm;
  left: 16mm;
  height: 259mm;
}

ul{
  list-style-type: none;
}

.lines{
  position: absolute;
  left: 0mm;
  width: 35mm;
  height: 30mm;
  border-bottom: 1px solid black;
  padding-left: 6mm;
}

.line1{
  top: 20mm;
}

.line2{
  top: 86mm;

}

.line3{
  top: 152mm;
}

.clients{
  position: absolute;
  left: 0mm;
  width: 160mm;
  padding-left: 12mm;
  padding-top: 33mm;
      }
      
/}
-->
</style>
</head>
  <body>
    <div class="page">
    <div class="page-title text-small">編集スタジオのご案内</div>
      <div class="line-left">
        <ul>
          <li class="lines line1">
          <span class="allign-bottom"><span class="text-small">Studio </span><span id="studio1" /></span>
          </li>
          <li class="clients line1" id="name1"></li>
          <li class="lines line2">
            <span class="allign-bottom"><span class="text-small">Studio </span><span id="studio2" /></span>
          </li>
          <li class="clients line2" id="name2"></li>
          <li class="lines line3">
             <span class="allign-bottom"><span class="text-small">Studio </span><span id="studio3" /></span>
          </li>
          <li class="clients line3" id="name3"></li>
        </ul>
      </div>
      <div class="stud">
        <img src="logo.svg" class="logo"><br>
        STUD Co., Ltd.
      </div>
</div>


<div class="control">
  <form method="" action="" onsubmit="return false">
    <ul>
      <li><h1>Guidance</h1></li>
      <li>
        <ul>
          <li><input type="checkbox" value="501" id="check501" checked="checked" /><label for="check501">Studio 501</label></li>
          <li><input type="text" name="client501A" id="client501A" value="501 社名" /></li>
          <li><input type="text" name="client501B" id="client501B" value="501 担当者名" /></li>
          </ul>
      </li>
      <li>
          <ul>
              <li><input type="checkbox" value="201" id="check201" checked="checked" /><label for="check201">Studio 201</label></li>
              <li><input type="text" name="client201A" id="client201A" value="201 社名" /></li>
              <li><input type="text" name="client201B" id="client201B" value="201 担当者名" /></li>
          </ul>
      </li>
      <li>
          <ul>
              <li><input type="checkbox" value="102" id="check102" checked="checked" /><label for="check102">Studio 102</label></li>
              <li><input type="text" name="client102A" id="client102A" value="102 社名" /></li>
              <li><input type="text" name="client102B" id="client102B" value="102 担当者名" /></li>
          </ul>
      </li>
      <li><button id="button-print" style="padding-left: 30px; padding-right: 30px;">印刷</button></li>
      <li><button id="button-save" style="padding-left: 30px; padding-right: 30px;">保存</button></li>
    </ul>
  </form>
</div>
<div id="status">前回情報を取得中...</div>





<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function () {

//読み込み
    $.getJSON('https://script.google.com/macros/s/AKfycbwfPRbaXmw_d2EGNC3cV_ery_MwBh5Htwr73hbf8p9vPWD6okMy/exec')
       // jsonの読み込みに成功した時
      .done(function(json){
        console.log(json);
        $("#status").text('前回の情報を取得しました');
        
        if(json['check501'] != '501'){
          $("#check501").prop('checked', false);
        }
        $("#client501A").val(json['client501A']);
        $("#client501B").val(json['client501B']);
        
        if(json['check201'] != '201'){
          $("#check201").prop('checked', false);
        }
        $("#client201A").val(json['client201A']);
        $("#client201B").val(json['client201B']);
        
        if(json['check102'] != '102'){
          $("#check102").prop('checked', false);
        }
        $("#client102A").val(json['client102A']);
        $("#client102B").val(json['client102B']);
        
      })
       // jsonの読み込みに失敗した時
      .fail(function(){
        $("#status").text('前回情報の取得に失敗しました。');
      });
    

//保存
$("#button-save").click(function() {
    $("#button-save").attr("disabled", true);
    $("#status").text('サーバに保存中...');

    var data = {
        check501: $("#check501").val(),
        client501A: $("#client501A").val(),
        client501B: $("#client501B").val(),
        check201: $("#check201").val(),
        client201A: $("#client201A").val(),
        client201B: $("#client201B").val(),
        check102: $("#check102").val(),
        client102A: $("#client102A").val(),
        client102B: $("#client102B").val(),
    };

    // 通信実行
    $.ajax({
        type:"post",
        url:"https://script.google.com/macros/s/AKfycbwfPRbaXmw_d2EGNC3cV_ery_MwBh5Htwr73hbf8p9vPWD6okMy/exec",
        data:JSON.stringify(data),
        contentType: 'application/json',
        success: function(json_data) {   // 200 OK時
            $("#status").text('保存しました');
        },
        error: function() {         // HTTPエラー時
            $("#status").text('保存に失敗しました');
        },
        complete: function() {      // 成功・失敗に関わらず通信が終了した際の処理
            $("#button-save").attr("disabled", false);  // ボタンを再び enableにする
        }
    });
});


//印刷
    $('#button-print').on('click', function (e) {
    updatePage();
      var cnt = $('input:checkbox:checked').length;
        if(cnt == 0){
          alert('全部屋が無効になっています。');
        } else {
          alert('Tips\n・送信先プリンターをお間違えなく\n・ヘッダーとフッターを非表示にしてください\n　（iOSでは設定できないので、必ず印刷されます）\n\niPhone/Safariの場合\n・空の2ページ目が出力されるので、ページ範囲で無効にしてください');
          window.print();
      }
    })
})

// 更新処理
    function updatePage() {
        // 各欄の更新処理
        $("#name2").html($("#client201A").val() + '<br>' + $("#client201B").val());
        $("#name3").html($("#client102A").val() + '<br>' + $("#client102B").val());

        var cnt = $('input:checkbox:checked').length;
        var studios = $('input:checkbox:checked').map(function(){return $(this).val();}).get();
        //0行
        if(cnt == 0){
          $(".line1").css("display", "none");
          $(".line2").css("display", "none");
          $(".line3").css("display", "none");
        }
        //1行
        else if(cnt == 1){
          $(".line1").css("display", "none");
          $(".line2").css("display", "block");
          $(".line2").css("top", "86mm");
          $(".line3").css("display", "none");
          $("#studio2").text(studios[0]);
          $("#name2").html($("#client" + studios[0] + "A").val() + '<br>' + $("#client" + studios[0] + "B").val());
        }
        //2行
        else if(cnt == 2){
          $(".line1").css("display", "block");
          $(".line1").css("top", "46mm");
          $(".line2").css("display", "none");
          $(".line3").css("display", "block");
          $(".line3").css("top", "130mm");
          $("#studio1").text(studios[0]);
          $("#name1").html($("#client" + studios[0] + "A").val() + '<br>' + $("#client" + studios[0] + "B").val());
          $("#studio3").text(studios[1]);
          $("#name3").html($("#client" + studios[1] + "A").val() + '<br>' + $("#client" + studios[1] + "B").val());
        }
        //3行
        else{
          $(".line1").css("display", "block");
          $(".line1").css("top", "20mm");
          $(".line2").css("display", "block");
          $(".line2").css("top", "86mm");
          $(".line3").css("display", "block");
          $(".line3").css("top", "152mm");
          $("#studio1").text(studios[0]);
          $("#name1").html($("#client" + studios[0] + "A").val() + '<br>' + $("#client" + studios[0] + "B").val());
          $("#studio2").text(studios[1]);
          $("#name2").html($("#client" + studios[1] + "A").val() + '<br>' + $("#client" + studios[1] + "B").val());
          $("#studio3").text(studios[2]);
          $("#name3").html($("#client" + studios[2] + "A").val() + '<br>' + $("#client" + studios[2] + "B").val());
        }
    }
</script>
  </body>
</html>