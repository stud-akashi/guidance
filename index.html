<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Guidance</title>
<meta name="viewport" content="width=device-width">
<link rel="apple-touch-icon" sizes="57x57" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://www.stud.jp/assets/img/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="https://www.stud.jp/assets/img/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://www.stud.jp/assets/img/favicons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="https://www.stud.jp/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://www.stud.jp/assets/img/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="https://www.stud.jp/assets/img/favicons/favicon-16x16.png" sizes="16x16">
<script>
  (function(d) {
    var config = {
      kitId: 'npc5aqa',
      scriptTimeout: 3000,
      async: true
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>
<style type="text/css">
<!--
@page{
  size: A4 portrait;
  margin: 0;
}
@media screen{
  div.page{
    display: none;
  }
  ul{
    list-style-type: none;
  }
  ol{
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    margin-bottom: 16px;
  }
  body{
    font-size: 20px;
  font-family: source-han-sans-japanese, sans-serif;
  font-weight: 400;
  font-style: normal;
  }

  input.textbox{
    font-size: 18px;
    font-family: source-han-sans-japanese, sans-serif;
    font-weight: 400;
    font-style: normal;
    margin: 3px;
    width: 300px;
  }
  button{
    font-size: 18px;
    font-family: source-han-sans-japanese, sans-serif;
    font-weight: 400;
    font-style: normal;
    margin: 3px;
    width: 100px;
  }
  h1{
    font-size: 36px;
    font-family: futura-pt, sans-serif;
    font-weight: 300;
    font-style: normal;
  }
  #status{
    font-size: 12px;
    color: silver;
  }
}
      
 @media print{
  body {
    -webkit-print-color-adjust: exact;
    top:0 !IMPORTANT;
    left:0 !IMPORTANT;
    width:200mm !IMPORTANT;
    height:285mm !IMPORTANT;
  }

div.control{
  display: none;
}

div.page{
  position: absolute;
  top: 50%;
  left: 50%;
  width: 182mm;
  height: 255mm;
  margin: -137.5mm 0 0 -91mm;
  border: 1px solid;
  border-color: white;
  border-collapse: collapse;

  font-family: source-han-sans-japanese, sans-serif;
  font-weight: 100;
  font-style: normal;
  font-size: 27pt;
}

.page-title{
  position: absolute;
  right: 9mm;
  top: 18mm;
  letter-spacing: 0.3em;
}

.stud{
  position: absolute;
  bottom: 8mm;
  right: 9mm;
  text-align: center;
  
  font-family: futura-pt, sans-serif;
  font-weight: 300;
  font-style: normal;
  font-size: 10pt;
}
.logo{
  width: 8.5mm;
  height: 8.5mm;
}
.allign-bottom{
  position: absolute;
  bottom: 2mm;
}

.text-small{
  font-size: 16pt;
}

.line-left{
  position: absolute;
  border-left: 1px black solid;
  position: absolute;
  top: 8mm;
  left: 16mm;
  height: 259mm;
}

ul{
  list-style-type: none;
}

.lines{
  position: absolute;
  left: 0mm;
  width: 35mm;
  height: 30mm;
  border-bottom: 1px solid black;
  padding-left: 6mm;
}

.line1{
  top: 20mm;
}

.line2{
  top: 86mm;

}

.line3{
  top: 152mm;
}

.clients{
  position: absolute;
  left: 0mm;
  width: 160mm;
  padding-left: 12mm;
  padding-top: 33mm;
      }
      
/}
-->
</style>
</head>
  <body>

<!--印刷部 -->
    <div class="page">
    <div class="page-title text-small">編集スタジオのご案内</div>
      <div class="line-left">
        <ul>
          <li class="lines line1">
          <span class="allign-bottom"><span class="text-small">Studio </span><span id="studio1" /></span>
          </li>
          <li class="clients line1" id="name1"></li>
          <li class="lines line2">
            <span class="allign-bottom"><span class="text-small">Studio </span><span id="studio2" /></span>
          </li>
          <li class="clients line2" id="name2"></li>
          <li class="lines line3">
             <span class="allign-bottom"><span class="text-small">Studio </span><span id="studio3" /></span>
          </li>
          <li class="clients line3" id="name3"></li>
        </ul>
      </div>
      <div class="stud">
        <img src="logo.svg" class="logo"><br>
        STUD Co., Ltd.
      </div>
</div>

<!--表示部 -->
<div class="control">
  <form method="" action="" onsubmit="return false">
<datalist id="clientList">
<option>AOI Pro.</option>
<option>東北新社</option>
<option>TYO</option>
<option>太陽企画</option>
<option>博報堂プロダクツ</option>
<option>電通クリエーティブX</option>
</datalist>　
    <ul>
      <li><h1>Guidance</h1></li>
      <li>
        <ol>
          <li><input type="checkbox" value="501" id="check501" checked="checked" /><label for="check501">Studio 501</label></li>
          <li><input type="text" name="client501A" class="textbox" id="client501A" placeholder="プロダクション名" list="clientList" /></li>
          <li><input type="text" name="client501B" class="textbox" id="client501B" placeholder="〇〇様" /></li>
          </ol>
      </li>
      <li>
          <ol>
              <li><input type="checkbox" value="201" id="check201" checked="checked" /><label for="check201">Studio 201</label></li>
              <li><input type="text" name="client201A" class="textbox" id="client201A" placeholder="プロダクション名" list="clientList" /></li>
              <li><input type="text" name="client201B" class="textbox" id="client201B" placeholder="〇〇様" /></li>
          </ol>
      </li>
      <li>
          <ol>
              <li><input type="checkbox" value="102" id="check102" checked="checked" /><label for="check102">Studio 102</label></li>
              <li><input type="text" name="client102A" class="textbox" id="client102A" placeholder="プロダクション名" list="clientList" /></li>
              <li><input type="text" name="client102B" class="textbox" id="client102B" placeholder="〇〇様" /></li>
          </ol>
      </li>
      <li><button id="button-save">保存</button><button id="button-print">印刷</button></li>
                <li id="status">前回情報を取得中...</li>

    </ul>
  </form>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function () {

//読み込み
    $.getJSON('https://script.google.com/macros/s/AKfycbwfPRbaXmw_d2EGNC3cV_ery_MwBh5Htwr73hbf8p9vPWD6okMy/exec')
      .done(function(json){ //成功
        console.log(json);
        $("#status").text('最終更新：' + json['lastUpdate']);
        
        if(json['check501'] != '501'){
          $("#check501").prop('checked', false);
        }
        $("#client501A").val(json['client501A']);
        $("#client501B").val(json['client501B']);
        
        if(json['check201'] != '201'){
          $("#check201").prop('checked', false);
        }
        $("#client201A").val(json['client201A']);
        $("#client201B").val(json['client201B']);
        
        if(json['check102'] != '102'){
          $("#check102").prop('checked', false);
        }
        $("#client102A").val(json['client102A']);
        $("#client102B").val(json['client102B']);
        
      }).fail(function(){ //失敗
        $("#status").text('前回情報の取得に失敗しました');
      }).always(function(){ //常に
        updatePage();
    });

//// 入力項目の更新に応じてプレビューも変更
$('input').on('keyup', function () {
    updatePage();
})

///チェックボックスでenable/disable
$("#check501").click(function () {
    updatePage();
    if($("#check501").prop('checked') == false){
      $("#client501A").prop('disabled', true);
      $("#client501B").prop('disabled', true);
    }else{
      $("#client501A").prop('disabled', false);
      $("#client501B").prop('disabled', false);
    }
})

$("#check201").click(function () {
    updatePage();
    if($("#check201").prop('checked') == false){
      $("#client201A").prop('disabled', true);
      $("#client201B").prop('disabled', true);
    }else{
      $("#client201A").prop('disabled', false);
      $("#client201B").prop('disabled', false);
    }
})

$("#check102").click(function () {
    updatePage();
    if($("#check102").prop('checked') == false){
      $("#client102A").prop('disabled', true);
      $("#client102B").prop('disabled', true);
    }else{
      $("#client102A").prop('disabled', false);
      $("#client102B").prop('disabled', false);
    }
})


//保存
$("#button-save").click(function() {
  saveGas();
});


//印刷
    $('#button-print').on('click', function (e) {
    updatePage();
      var cnt = $('input:checkbox:checked').length;
        if(cnt == 0){
          alert('全部屋が無効になっています。');
        } else {
          alert('Tips\n・送信先プリンターをお間違えなく\n・ヘッダーとフッターを非表示にしてください\n　（iOSでは設定できないので、必ず印刷されます）\n\niPhone/Safariの場合\n・空の2ページ目が出力されるので、ページ範囲で無効にしてください');
          window.print();
          saveGas();
      }
    })
})

// 更新処理
    function updatePage() {
        // 各欄の更新処理
        $("#name2").html($("#client201A").val() + '<br>' + $("#client201B").val());
        $("#name3").html($("#client102A").val() + '<br>' + $("#client102B").val());

        var cnt = $('input:checkbox:checked').length;
        var studios = $('input:checkbox:checked').map(function(){return $(this).val();}).get();
        //0行
        if(cnt == 0){
          $(".line1").css("display", "none");
          $(".line2").css("display", "none");
          $(".line3").css("display", "none");
        }
        //1行
        else if(cnt == 1){
          $(".line1").css("display", "none");
          $(".line2").css("display", "block");
          $(".line2").css("top", "86mm");
          $(".line3").css("display", "none");
          $("#studio2").text(studios[0]);
          $("#name2").html($("#client" + studios[0] + "A").val() + '<br>' + $("#client" + studios[0] + "B").val());
        }
        //2行
        else if(cnt == 2){
          $(".line1").css("display", "block");
          $(".line1").css("top", "46mm");
          $(".line2").css("display", "none");
          $(".line3").css("display", "block");
          $(".line3").css("top", "130mm");
          $("#studio1").text(studios[0]);
          $("#name1").html($("#client" + studios[0] + "A").val() + '<br>' + $("#client" + studios[0] + "B").val());
          $("#studio3").text(studios[1]);
          $("#name3").html($("#client" + studios[1] + "A").val() + '<br>' + $("#client" + studios[1] + "B").val());
        }
        //3行
        else{
          $(".line1").css("display", "block");
          $(".line1").css("top", "20mm");
          $(".line2").css("display", "block");
          $(".line2").css("top", "86mm");
          $(".line3").css("display", "block");
          $(".line3").css("top", "152mm");
          $("#studio1").text(studios[0]);
          $("#name1").html($("#client" + studios[0] + "A").val() + '<br>' + $("#client" + studios[0] + "B").val());
          $("#studio2").text(studios[1]);
          $("#name2").html($("#client" + studios[1] + "A").val() + '<br>' + $("#client" + studios[1] + "B").val());
          $("#studio3").text(studios[2]);
          $("#name3").html($("#client" + studios[2] + "A").val() + '<br>' + $("#client" + studios[2] + "B").val());
        }
      $("div.page").css("font-family", "source-han-sans-japanese, sans-serif");
      $("div.page").css("font-weight", "100");
      $("div.page").css("font-style", "normal");
    }

function saveGas(){
      $("#button-save").attr("disabled", true);
      $("#status").text('サーバに保存中...');
        var data = {
            check501: $("#check501:checked").val(),
            client501A: $("#client501A").val(),
            client501B: $("#client501B").val(),
            check201: $("#check201:checked").val(),
            client201A: $("#client201A").val(),
            client201B: $("#client201B").val(),
            check102: $("#check102:checked").val(),
            client102A: $("#client102A").val(),
            client102B: $("#client102B").val(),
        };
        // 通信実行
        $.ajax({
            type:"get",
            url:"https://script.google.com/macros/s/AKfycbwfPRbaXmw_d2EGNC3cV_ery_MwBh5Htwr73hbf8p9vPWD6okMy/exec",
            data: data})
            .done(function(json_data){
                $("#status").text('保存しました');
            }).fail(function(){
                $("#status").text('保存に失敗しました');
            }).always(function(){
                $("#button-save").attr("disabled", false);  // ボタンを再び enableにする
      });
}
</script>
  </body>
</html>